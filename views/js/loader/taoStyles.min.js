define("taoStyles/controller/routes",[],function(){return{Main:{actions:{index:"controller/styles/index"}}}}),define("tpl!taoStyles/editor/operatedBy",["handlebars"],function(hb){return hb.template(function(helper,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var options,buffer="",helperMissing=(helpers=this.merge(helpers,helper.helpers)).helperMissing,escapeExpression=this.escapeExpression;return buffer+='<a href="#" class="operator-by">\n    <span>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Operated by",options):helperMissing.call(depth0,"__","Operated by",options
)))+'</span>\n    <span class="operator-name">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Your Company Name",options):helperMissing.call(depth0,"__","Your Company Name",options)))+"</span>\n</a>"})}),define("taoStyles/editor/editor",["jquery","i18n","lodash","core/promise","ui/feedback","ui/uploader","ui/dialog","tpl!taoStyles/editor/operatedBy"],function($,__,_,Promise,feedback,uploader,dialog,obTpl){"use strict";var cssLink,operatedBy,opText,form=document.forms["tao-styles-form"],$form=$(form),data={},originalData={},ns="styleeditor",requireConfirmation=!1;function changeButtonState(state){
$form.find(".bottom-action-bar button").each(function(){this.disabled=state})}function initForm(){$form.find('button[type="submit"]').on("click."+ns,function(){this.form.checkValidity()||this.form.elements.operatedByEmail.scrollIntoView()}),$form.find('button[type="reset"]').on("click."+ns,function(e){var message;e.stopImmediatePropagation(),e.preventDefault(),message=__("This will discard all your current changes, are you sure?"),new Promise(function(resolve,reject){var confirmDlg;return _.isEqual(data,originalData)?resolve():requireConfirmation?reject():(requireConfirmation=!0,void(confirmDlg=dialog({message:message,buttons:[{id:"dontsave",type:"regular",
label:$form.find('.bottom-action-bar [role="style-reset"]').attr("title"),close:!0},{id:"cancel",type:"regular",label:$form.find('.bottom-action-bar [role="style-saver"]').attr("title"),close:!0}],autoRender:!0,autoDestroy:!0,onDontsaveBtn:resolve,onCancelBtn:function(){return confirmDlg.hide(),reject()}}).on("closed.modal",function(){requireConfirmation=!1})))}).then(function(){form.reset(),$form.find(":checked").parents("figure").trigger("click"),applyLogo(data=_.cloneDeep(originalData)),$(".file-drop .icon-close").trigger("click"),changeButtonState(!0)}).catch(_.noop)}),$form.on("submit."+ns,function(e){var errorMsg=__(
"An error occurred while saving your theme"),errorMsgUrl=__("Logo link URL is not valid"),regexUrl=new RegExp("^http(s)?://[^<>()]+$");if(e.preventDefault(),data.link&&!regexUrl.test(data.link))return feedback().error(errorMsgUrl),!1;$.ajax({type:form.method,url:form.action,data:{theme:data},success:function(response){_.isNull(response)?feedback().error(errorMsg):originalData=data,feedback()[response.type](response.msg)},error:function(){feedback().error(errorMsg)},dataType:"json"})}),""===form.querySelector(".logoUrl").getAttribute("src")?data.logoUrl="":data.logoUrl=form.querySelector(".logoUrl").src}function applyLogo(logoData){
data.logoUrl=logoData.logoUrl||"data:"+logoData.mime+";base64,"+logoData.image,$("#tao-main-logo, .logoUrl").each(function(){this.src=data.logoUrl})}function initOperatedBy(){$("body>footer>.rgt").empty().append($(obTpl()));var $current,i,$formFields=null,formElementNamesToSave=["operatedByEmail","operatedByName","link","message"];for(i in formElementNamesToSave)applyFormField($current=form.elements[formElementNamesToSave[i]]),$formFields=null==$formFields?$($current):$formFields.add($($current));applyOperatedBy(),$formFields.on("invalid."+ns,function(e){var msg,text=$(e.target).parent().find("span").text().trim();e.target.setCustomValidity(""),
"email"===e.target.type&&e.target.validity.typeMismatch?(msg=__("Please provide a valid email address"),e.target.setCustomValidity(msg)):"url"===e.target.type&&e.target.validity.typeMismatch?(msg=__("Please provide a valid logo link! (start with http:// or https://)"),e.target.setCustomValidity(msg)):e.target.validity.valid||(msg=__('"%s" cannot be left blank',text),e.target.setCustomValidity(msg))}).on("input."+ns,function(e){var msg,hasError=!1;applyFormField(this),e.target.setCustomValidity(""),"email"===e.target.type&&e.target.validity.typeMismatch?(msg=__("Please provide a valid email address"),e.target.setCustomValidity(msg),hasError=!0
):"url"===e.target.type&&e.target.validity.typeMismatch&&(msg=__("Please provide a valid logo link! (start with http:// or https://)"),e.target.setCustomValidity(msg),changeButtonState(!(hasError=!0))),hasError||(applyOperatedBy(),$("#tao-main-logo").parent().attr("title",data.message).attr("href",data.link),changeButtonState(!1))})}function applyFormField(field){data[field.name]=field.value}function applyOperatedBy(){operatedBy=operatedBy||document.querySelector("body>footer .operator-by"),opText=opText||operatedBy.querySelector(".operator-name"),data.operatedByName&&data.operatedByEmail&&(operatedBy.href="mailto:"+data.operatedByEmail,
opText.textContent=data.operatedByName)}return{setup:function(){var errors,$uploader;initForm(),errors=[],($uploader=$("#upload-container")).on("upload.uploader",function(e,file,logoData){applyLogo(logoData),changeButtonState(!1)}).on("fail.uploader",function(e,file,err){errors.push(__("Unable to upload file %s : %s",file.name,err))}).on("end.uploader",function(){0<errors.length&&feedback().error("<ul><li>"+errors.join("</li><li>")+"</li></ul>",{encodeHtml:!1}),errors=[]}).on("create.uploader",function(){$(".logo-area").on("click",function(){$('[name="content"]').trigger("click")})}),$uploader.uploader({upload:!0,uploadUrl:$uploader.data("url")}),$form.find(
"figure").on("click."+ns,function(){var self=this;data.stylesheet=self.dataset.css,data.label=self.querySelector("label").textContent.trim(),data.id=self.querySelector('[name="id"]').value,data.colors=function(){for(var params=self.querySelectorAll("object>param"),i=params.length,colors={};i--;)colors[params[i].name]=params[i].value;return colors}(),$("link[href^='data:text/css;charset=utf-8;base64']").remove(),(cssLink=cssLink||form.querySelector('link[rel="stylesheet"]')).href=data.stylesheet,changeButtonState(!1)}),$form.find(":checked").parents("figure").trigger("click"),initOperatedBy(),originalData=_.cloneDeep(data),changeButtonState(!0)}}}),define(
"taoStyles/controller/styles/index",["jquery","taoStyles/editor/editor"],function($,editor){"use strict";return{start:function(){editor.setup()}}}),define("taoStyles/loader/taoStyles.bundle",function(){});
//# sourceMappingURL=taoStyles.min.js.map